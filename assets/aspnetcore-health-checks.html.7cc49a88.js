import{r as t,o as e,c,b as n,a,F as o,e as l,d as p}from"./app.d1ef40ff.js";import{_ as u}from"./plugin-vue_export-helper.21dcd24c.js";const i={},r=l(`<h1 id="asp-net-core-\u5065\u5EB7\u68C0\u67E5" tabindex="-1"><a class="header-anchor" href="#asp-net-core-\u5065\u5EB7\u68C0\u67E5" aria-hidden="true">#</a> ASP.NET Core \u5065\u5EB7\u68C0\u67E5</h1><div class="custom-container tip"><p class="custom-container-title">\u63D0\u793A</p><p>\u5DE5\u5177\uFF1A<code>VS2019</code></p><p>\u6846\u67B6\uFF1A<code>ASP.NET Core5.0</code></p><p>\u8BF4\u660E\uFF1A.net core5.0\u4E4B\u524D\u548C5.0\u7248\u672C\u7684\u5065\u5EB7\u68C0\u67E5\u6709\u4E00\u5B9A\u5DEE\u5F02\uFF0C\u8FD9\u91CC\u53EA\u8BB2\u89E35.0\u7248\u672C\u7684\u4F7F\u7528</p></div><h2 id="\u5065\u5EB7\u68C0\u67E5healthchecks" tabindex="-1"><a class="header-anchor" href="#\u5065\u5EB7\u68C0\u67E5healthchecks" aria-hidden="true">#</a> \u5065\u5EB7\u68C0\u67E5HealthChecks</h2><h3 id="\u57FA\u672C\u64CD\u4F5C" tabindex="-1"><a class="header-anchor" href="#\u57FA\u672C\u64CD\u4F5C" aria-hidden="true">#</a> \u57FA\u672C\u64CD\u4F5C</h3><p>\u9996\u5148\u5F15\u5165\u5305<code>Microsoft.Extensions.Diagnostics.HealthChecks</code></p><p>\u5728<code>Startup.ConfigureServices</code>\u4E2D\u4F7F\u7528<code>AddHealthChecks</code>\u6CE8\u518C\u8FD0\u884C\u72B6\u51B5\u68C0\u67E5\u670D\u52A1\u3002 \u901A\u8FC7\u5728<code>Startup.Configure</code>\u4E2D\u8C03\u7528<code>MapHealthChecks</code>\u6765\u521B\u5EFA\u8FD0\u884C\u72B6\u51B5\u68C0\u67E5\u7EC8\u7ED3\u70B9\u3002 \u5728\u793A\u4F8B\u5E94\u7528\u4E2D\uFF0C\u5728<code>/health</code>\u5904\u521B\u5EFA\u8FD0\u884C\u72B6\u51B5\u68C0\u67E5\u7EC8\u7ED3\u70B9</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Startup</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        services<span class="token punctuation">.</span><span class="token function">AddHealthChecks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        app<span class="token punctuation">.</span><span class="token function">UseEndpoints</span><span class="token punctuation">(</span>endpoints <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            endpoints<span class="token punctuation">.</span><span class="token function">MapHealthChecks</span><span class="token punctuation">(</span><span class="token string">&quot;/health&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>\u542F\u52A8\u9879\u76EE\uFF0C\u901A\u8FC7\u8BBF\u95EE<code>/health</code>\u8DEF\u5F84\u67E5\u770B\u5E94\u7528\u72B6\u6001\uFF0C\u8FD9\u6837\u4E00\u4E2A\u7B80\u5355\u7684\u5065\u5EB7\u68C0\u67E5\u5176\u5B9E\u5C31\u7B97\u5B8C\u4E86</p><h3 id="\u81EA\u5B9A\u4E49\u68C0\u67E5" tabindex="-1"><a class="header-anchor" href="#\u81EA\u5B9A\u4E49\u68C0\u67E5" aria-hidden="true">#</a> \u81EA\u5B9A\u4E49\u68C0\u67E5</h3><p>\u901A\u8FC7<code>AddCheck</code>\u65B9\u6CD5\u5B9E\u73B0\u81EA\u5B9A\u4E49\u68C0\u67E5</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code>services<span class="token punctuation">.</span><span class="token function">AddHealthChecks</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddCheck</span><span class="token punctuation">(</span><span class="token string">&quot;Example&quot;</span><span class="token punctuation">,</span> _ <span class="token operator">=&gt;</span>
        HealthCheckResult<span class="token punctuation">.</span><span class="token function">Healthy</span><span class="token punctuation">(</span><span class="token string">&quot;Example is OK!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">tags</span><span class="token punctuation">:</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token string">&quot;example&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u4E5F\u53EF\u4EE5\u8C03\u7528\u8BE5\u65B9\u6CD5\u7684\u6CDB\u578B\u6A21\u5F0F\uFF0C\u9996\u5148\u9700\u8981\u5B9A\u4E49\u4E00\u4E2A\u7EE7\u627F\u81EA<code>IHealthCheck</code>\u7684\u63A5\u53E3</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExampleHealthCheck</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IHealthCheck</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>HealthCheckResult<span class="token punctuation">&gt;</span></span> <span class="token function">CheckHealthAsync</span><span class="token punctuation">(</span>
        <span class="token class-name">HealthCheckContext</span> context<span class="token punctuation">,</span>
        <span class="token class-name">CancellationToken</span> cancellationToken <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">(</span><span class="token type-expression class-name">CancellationToken</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> healthCheckResultHealthy <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>healthCheckResultHealthy<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> Task<span class="token punctuation">.</span><span class="token function">FromResult</span><span class="token punctuation">(</span>
                HealthCheckResult<span class="token punctuation">.</span><span class="token function">Healthy</span><span class="token punctuation">(</span><span class="token string">&quot;A healthy result.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> Task<span class="token punctuation">.</span><span class="token function">FromResult</span><span class="token punctuation">(</span>
            HealthCheckResult<span class="token punctuation">.</span><span class="token function">Unhealthy</span><span class="token punctuation">(</span><span class="token string">&quot;An unhealthy result.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>\u7136\u540E\u901A\u8FC7\u8C03\u7528\u8BE5\u63A5\u53E3\u5B9E\u73B0\u81EA\u5B9A\u4E49\u5065\u5EB7\u68C0\u67E5</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code>services<span class="token punctuation">.</span><span class="token function">AddHealthChecks</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddCheck</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ExampleHealthCheck<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;example_health_check&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="\u5065\u5EB7\u68C0\u67E5\u5E93" tabindex="-1"><a class="header-anchor" href="#\u5065\u5EB7\u68C0\u67E5\u5E93" aria-hidden="true">#</a> \u5065\u5EB7\u68C0\u67E5\u5E93</h3><p>\u53EF\u4EE5\u5BF9\u6570\u636E\u5E93\u3001redis\u7B49\u8FDB\u884C\u68C0\u67E5\uFF0C\u6BD4\u5982mysql\uFF0C\u9700\u8981\u5148\u5F15\u5165<code>HealthChecks.MySql</code>\u5E93\uFF0C\u7136\u540E\u5728<code>ConfigureServices</code>\u65B9\u6CD5\u4E2D\u6DFB\u52A0\u5982\u4E0B\u4EE3\u7801\u5373\u53EF</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    services<span class="token punctuation">.</span><span class="token function">AddHealthChecks</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">AddMySql</span><span class="token punctuation">(</span>
            <span class="token named-parameter punctuation">connectionString</span><span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span><span class="token function">GetConnectionString</span><span class="token punctuation">(</span><span class="token string">&quot;MySqlConnection&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token named-parameter punctuation">name</span><span class="token punctuation">:</span> <span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span>
            <span class="token named-parameter punctuation">failureStatus</span><span class="token punctuation">:</span> HealthStatus<span class="token punctuation">.</span>Degraded<span class="token punctuation">,</span>
            <span class="token named-parameter punctuation">tags</span><span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> <span class="token string">&quot;db&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;mysql&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p>\u5982\u679C\u8981\u5BF9Redis\u8FDB\u884C\u68C0\u67E5\uFF0C\u5148\u5F15\u5165<code>HealthChecks.Redis</code>\u5E93\uFF0C\u7136\u540E\u7167\u732B\u753B\u864E\u76F4\u63A5\u5728\u540E\u9762\u8C03\u7528<code>AddRedis()</code>\uFF0C\u8FD8\u6709\u5176\u5B83\u591A\u79CD\u68C0\u67E5\u4E5F\u662F\u4E00\u6837</p></blockquote><h3 id="\u81EA\u5B9A\u4E49\u8F93\u51FA" tabindex="-1"><a class="header-anchor" href="#\u81EA\u5B9A\u4E49\u8F93\u51FA" aria-hidden="true">#</a> \u81EA\u5B9A\u4E49\u8F93\u51FA</h3><h4 id="\u5168\u90E8\u8F93\u51FA" tabindex="-1"><a class="header-anchor" href="#\u5168\u90E8\u8F93\u51FA" aria-hidden="true">#</a> \u5168\u90E8\u8F93\u51FA</h4><p>\u73B0\u5728\u6211\u4EEC\u77E5\u9053\u5065\u5EB7\u68C0\u67E5\u53EF\u4EE5\u5BF9\u591A\u79CD\u4E1A\u52A1\u8FDB\u884C\u68C0\u67E5\uFF0C\u5982\u679C\u4E00\u4E2A\u9879\u76EE\u6709\u591A\u9879\u68C0\u67E5\uFF0C\u6B64\u65F6\u901A\u8FC7\u8BBF\u95EE<code>/health</code>\u5730\u5740\u5176\u5B9E\u53EA\u80FD\u770B\u5230\u4E00\u4E2A\u8F93\u51FA\u503C\uFF0C\u8FD9\u5176\u5B9E\u662F\u6CA1\u6709\u610F\u4E49\u7684\uFF0C\u8981\u60F3\u770B\u5230\u5B8C\u6574\u7684\u8F93\u51FA\u7ED3\u679C\uFF0C\u53EA\u9700\u8981\u7A0D\u5FAE\u6539\u9020\u4E00\u4E0B\u4EE3\u7801\u5373\u53EF</p><p>\u5728<code>Startup.Configure</code>\u4E2D\uFF0C\u5C06<code>HealthCheckOptions.ResponseWriter</code>\u9009\u9879\u8BBE\u7F6E\u4E3A\u7F16\u5199\u54CD\u5E94\u7684\u59D4\u6258\uFF1A</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    app<span class="token punctuation">.</span><span class="token function">UseEndpoints</span><span class="token punctuation">(</span>endpoints <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        endpoints<span class="token punctuation">.</span><span class="token function">MapHealthChecks</span><span class="token punctuation">(</span><span class="token string">&quot;/health&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HealthCheckOptions</span>
        <span class="token punctuation">{</span>
            Predicate <span class="token operator">=</span> _ <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            ResponseWriter <span class="token operator">=</span> UIResponseWriter<span class="token punctuation">.</span>WriteHealthCheckUIResponse
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>\u73B0\u5728\u8BBF\u95EE<code>/health</code>\u5730\u5740\u5C31\u80FD\u770B\u5230\u4E00\u4E32json\u6570\u636E\uFF0C\u8BE5\u6570\u636E\u5305\u542B\u4E86\u6240\u6709\u68C0\u67E5\u9879\u76EE\u7684\u5065\u5EB7\u72B6\u51B5</p><h4 id="\u90E8\u5206\u8F93\u51FA" tabindex="-1"><a class="header-anchor" href="#\u90E8\u5206\u8F93\u51FA" aria-hidden="true">#</a> \u90E8\u5206\u8F93\u51FA</h4><p>\u5982\u679C\u6211\u4EEC\u5B9E\u73B0\u4E86\u591A\u9879\u5065\u5EB7\u68C0\u67E5\uFF0C\u73B0\u5728\u60F3\u8F93\u51FA\u90E8\u5206\u7ED3\u679C\uFF0C\u6BD4\u5982\u63D0\u4F9B\u7ED9consul\u505A\u5FC3\u8DF3\u5305\u68C0\u6D4B\uFF0C\u53EF\u4EE5\u5BF9<code>HealthCheckOptions</code>\u7684<code>Predicate</code>\u53C2\u6570\u505A\u8FC7\u6EE4</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Startup</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        services<span class="token punctuation">.</span><span class="token function">AddHealthChecks</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">AddCheck</span><span class="token punctuation">(</span><span class="token string">&quot;self&quot;</span><span class="token punctuation">,</span> _ <span class="token operator">=&gt;</span>
                HealthCheckResult<span class="token punctuation">.</span><span class="token function">Healthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">tags</span><span class="token punctuation">:</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token string">&quot;self&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        app<span class="token punctuation">.</span><span class="token function">UseEndpoints</span><span class="token punctuation">(</span>endpoints <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            endpoints<span class="token punctuation">.</span><span class="token function">MapHealthChecks</span><span class="token punctuation">(</span><span class="token string">&quot;/liveness&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HealthCheckOptions</span>
            <span class="token punctuation">{</span>
                Predicate <span class="token operator">=</span> r <span class="token operator">=&gt;</span> r<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">&quot;self&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="\u5F15\u5165ui" tabindex="-1"><a class="header-anchor" href="#\u5F15\u5165ui" aria-hidden="true">#</a> \u5F15\u5165UI</h2><blockquote><p><strong>UI\u72EC\u7ACB\u4E8E\u5065\u5EB7\u68C0\u67E5\uFF0C\u53EF\u4EE5\u8FDC\u7A0B\u8C03\u7528\uFF0C\u53EA\u9700\u8981\u77E5\u9053\u524D\u9762\u63D0\u5230\u7684<code>/health</code>\u5730\u5740\u5B8C\u6574\u7684\u8F93\u51FA\u7ED3\u679C\uFF0C\u4E00\u5B9A\u8981\u662F\u5B8C\u6574\u7684\u7ED3\u679C\u624D\u884C</strong></p></blockquote><h3 id="\u6CE8\u518C" tabindex="-1"><a class="header-anchor" href="#\u6CE8\u518C" aria-hidden="true">#</a> \u6CE8\u518C</h3><p>\u9996\u5148\u5F15\u5165<code>HealthChecks.UI</code>\u5E93\uFF0C\u7136\u540E\u5728<code>Starup.ConfigureServices</code>\u4E2D\u4F7F\u7528<code>AddHealthChecksUI</code>\u6CE8\u518C\uFF0C\u5728<code>Startup.Configure</code>\u4E2D\u8C03\u7528<code>MapHealthChecksUI</code>\u521B\u5EFAUI\u7EC8\u7ED3\u70B9</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Startup</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        services<span class="token punctuation">.</span><span class="token function">AddHealthChecksUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">AddInMemoryStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// \u5C06\u8BB0\u5F55\u5B58\u50A8\u5230\u5185\u5B58\u4E2D</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        app<span class="token punctuation">.</span><span class="token function">UseEndpoints</span><span class="token punctuation">(</span>endpoints <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            endpoints<span class="token punctuation">.</span><span class="token function">MapHealthChecksUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="\u914D\u7F6E\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a> \u914D\u7F6E\u6587\u4EF6</h3><ul><li>\u8C03\u7528<code>AddHealthChecksUI()</code>\u65B9\u6CD5\u9ED8\u8BA4\u8BFB\u53D6\u7684\u914D\u7F6E\u6587\u4EF6\uFF0C\u6240\u4EE5\u8FD8\u9700\u8981\u5728appsettings.json\u4E2D\u6DFB\u52A0\u914D\u7F6E\u4FE1\u606F\uFF0C\u4EE5\u4E0B\u6DFB\u52A0\u4E862\u4E2A\u7AD9\u70B9\u7684\u5065\u5EB7\u68C0\u67E5\u7EC8\u7ED3\u70B9</li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;HealthChecksUI&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;HealthChecks&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;Name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Example1&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Uri&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:57941/health&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;Name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Example2&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Uri&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:52382/health&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;Webhooks&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;Name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Uri&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Payload&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;RestoredPayload&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;EvaluationTimeInSeconds&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token property">&quot;MinimumSecondsBetweenFailureNotifications&quot;</span><span class="token operator">:</span> <span class="token number">60</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><ul><li>\u5F53\u7136\u6211\u4EEC\u4E5F\u53EF\u4EE5\u4E0D\u7528\u914D\u7F6E\u6587\u4EF6\uFF0C\u800C\u76F4\u63A5\u901A\u8FC7\u4F20\u53C2\u7684\u65B9\u5F0F\u6765\u8C03\u7528</li></ul><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code>services<span class="token punctuation">.</span><span class="token function">AddHealthChecksUI</span><span class="token punctuation">(</span>setup <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    setup<span class="token punctuation">.</span><span class="token function">AddHealthCheckEndpoint</span><span class="token punctuation">(</span><span class="token string">&quot;endpoint1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://localhost:8001/health&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    setup<span class="token punctuation">.</span><span class="token function">AddHealthCheckEndpoint</span><span class="token punctuation">(</span><span class="token string">&quot;endpoint2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://remoteendpoint:9000/health&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    setup<span class="token punctuation">.</span><span class="token function">AddWebhookNotification</span><span class="token punctuation">(</span><span class="token string">&quot;webhook1&quot;</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">uri</span><span class="token punctuation">:</span> <span class="token string">&quot;http://httpbin.org/status/200?code=ax3rt56s&quot;</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">payload</span><span class="token punctuation">:</span> <span class="token string">&quot;{...}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u5230\u8FD9\u91CC\u6574\u4E2AUI\u7684\u914D\u7F6E\u548C\u4EE3\u7801\u5C31\u5DF2\u7ECF\u5B8C\u6210\u4E86\uFF0C\u73B0\u5728\u6211\u4EEC\u53EF\u4EE5\u542F\u52A8\u8BE5\u7AD9\u70B9\u8BBF\u95EE<code>/healthchecks-ui</code>\u8DEF\u5F84\u67E5\u770B\u6548\u679C</p><h3 id="\u5065\u5EB7\u72B6\u51B5\u8BB0\u5F55\u5B58\u50A8" tabindex="-1"><a class="header-anchor" href="#\u5065\u5EB7\u72B6\u51B5\u8BB0\u5F55\u5B58\u50A8" aria-hidden="true">#</a> \u5065\u5EB7\u72B6\u51B5\u8BB0\u5F55\u5B58\u50A8</h3><p>ASP.NET Core 5.0\u4E2D\u5065\u5EB7\u68C0\u67E5UI\u5C55\u793A\u7ED3\u679C\u662F\u4ECE\u524D\u9762\u6307\u5B9A\u7684<code>/health</code>\u5730\u5740\u83B7\u53D6\uFF0C\u4F46\u662F\u6BCF\u4E00\u9879\u68C0\u67E5\u7684\u5065\u5EB7\u72B6\u6001\u90FD\u53EF\u80FD\u4F1A\u53D1\u751F\u53D8\u5316\uFF0C\u4E3A\u4E86\u770B\u5230\u6BCF\u4E00\u9879\u7684\u5065\u5EB7\u72B6\u51B5\u8BB0\u5F55\uFF0CUI\u81EA\u8EAB\u6307\u5B9A\u4E86\u7ED3\u679C\u5B58\u50A8\u96C6\uFF0C\u53EF\u4EE5\u5B58\u50A8\u5230\u5185\u5B58\u3001\u6570\u636E\u5E93\u7B49\u6570\u636E\u96C6\u4E2D\uFF0C\u901A\u8FC7\u5F15\u5165\u4E0D\u540C\u7684\u5E93\uFF08<code>HealthChecks.UI.XXX.Storage</code>\uFF09\u6765\u6307\u5B9A</p><p>\u4EE5\u4E0B\u793A\u4F8B\u5C55\u793A\u4FDD\u5B58\u7ED3\u679C\u5230MySQL\u4E2D\uFF0C\u9996\u5148\u5F15\u5165<code>HealthChecks.UI.MySql.Storage</code>\u5E93</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    services<span class="token punctuation">.</span><span class="token function">AddHealthChecksUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">AddMySqlStorage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span><span class="token function">GetConnectionString</span><span class="token punctuation">(</span><span class="token string">&quot;MySqlConnection&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="\u8DF3\u8F6C\u5230ui" tabindex="-1"><a class="header-anchor" href="#\u8DF3\u8F6C\u5230ui" aria-hidden="true">#</a> \u8DF3\u8F6C\u5230UI</h3><p>\u56E0\u4E3A\u6211\u662F\u5355\u72EC\u8D77\u7684\u4E00\u4E2A\u9879\u76EE\u6765\u5C55\u793AUI\uFF0C\u6240\u4EE5\u4E3A\u4E86\u65B9\u4FBF\u505A\u4E86\u4E00\u4E2A\u8DF3\u8F6C</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    endpoints<span class="token punctuation">.</span><span class="token function">MapGet</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> context <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// \u76F4\u63A5\u8DF3\u8F6C\u5230\u5065\u5EB7\u68C0\u67E5UI\u9996\u9875</span>
        context<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span><span class="token string">&quot;/healthchecks-ui&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> Task<span class="token punctuation">.</span>CompletedTask<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token function">UseEndpoints</span><span class="token punctuation">(</span>endpoints <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        endpoints<span class="token punctuation">.</span><span class="token function">MapHealthChecksUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="\u76F8\u5173\u94FE\u63A5" tabindex="-1"><a class="header-anchor" href="#\u76F8\u5173\u94FE\u63A5" aria-hidden="true">#</a> \u76F8\u5173\u94FE\u63A5</h2>`,47),k={href:"https://blog.zhaytam.com/2020/04/30/health-checks-aspnetcore/",title:"HEALTH CHECKS IN ASP.NET CORE",target:"_blank",rel:"noopener noreferrer"},d=p("HEALTH CHECKS IN ASP.NET CORE"),b={href:"https://github.com/Xabaril/AspNetCore.Diagnostics.HealthChecks",title:"AspNetCore.Diagnostics.HealthChecks",target:"_blank",rel:"noopener noreferrer"},h=p("AspNetCore.Diagnostics.HealthChecks"),m={href:"https://docs.microsoft.com/zh-cn/aspnet/core/host-and-deploy/health-checks?view=aspnetcore-5.0",title:"ASP.NET Core \u4E2D\u7684\u8FD0\u884C\u72B6\u51B5\u68C0\u67E5",target:"_blank",rel:"noopener noreferrer"},g=p("ASP.NET Core \u4E2D\u7684\u8FD0\u884C\u72B6\u51B5\u68C0\u67E5");function q(f,C){const s=t("ExternalLinkIcon");return e(),c(o,null,[r,n("ul",null,[n("li",null,[n("a",k,[d,a(s)])]),n("li",null,[n("a",b,[h,a(s)])]),n("li",null,[n("a",m,[g,a(s)])])])],64)}var H=u(i,[["render",q]]);export{H as default};
